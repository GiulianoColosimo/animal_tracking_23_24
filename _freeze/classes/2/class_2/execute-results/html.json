{
  "hash": "eb2d295bda071ba336eb97cbbcca1197",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Animal tracking nella biologia della conservazione\"\nsubtitle: \"Class 2\"\ndate: \"2024-05-09\"\nfooter:  \"[Animal tracking nella biologia della conservazione - Giuliano Colosimo, PhD](https://giulianocolosimo.github.io/animal_tracking_23_24/)\"\nlogo: ../../figures/Tor-Vergata_logo_cmyk.png\nformat: \n  revealjs:\n    width: 1600\n    height: 900\n    theme: slides.scss\n    multiplex: true\n    transition: fade\n    slide-number: true\n    chalkboard: \n      boardmarker-width: 5\neditor: visual\nfrom: markdown+emoji\nexecute:\n  freeze: auto\neditor_options: \n  chunk_output_type: console\nbibliography: /Users/giulianocolosimo/Library/CloudStorage/ProtonDrive-giuliano.colosimo@protonmail.com/manuscripts/literature/bibtex/comprehensive_database.bib\ncsl: /Users/giulianocolosimo/Library/CloudStorage/ProtonDrive-giuliano.colosimo@protonmail.com/manuscripts/literature/bibtex/apa_5th_edition.csl\ncitation_package: biblatex\ncitecolor: \"red\"\n---\n\n\n\n\n\n## Topics\n\n::: columns\n::: {.column width=\"50%\"}\n1.  [Setting up your computers]{style=\"color: green;\"}\n    -   [Packages to install]{style=\"color: green;\"}\n2.  [An introduction to Animal tracking]{style=\"color: green;\"}\n    -   [Tagging systems]{style=\"color: green;\"}\n3.  [CRS]{style=\"color: green;\"}\n    -   [Telemetry and GPS]{style=\"color: orange;\"}\n4.  [Movement Data]{style=\"color: orange;\"}\n5.  [On-line databases]{style=\"color: orange;\"}\n    -   [GBIF]{style=\"color: orange;\"}\n    -   [Movebank]{style=\"color: orange;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n6.  [Drivers of species distribution]{style=\"color: GhostWhite;\"}\n7.  [Home range estimates]{style=\"color: GhostWhite;\"}\n    -   [MPC]{style=\"color: GhostWhite;\"}\n    -   [KDE]{style=\"color: GhostWhite;\"}\n    -   [Kriging]{style=\"color: GhostWhite;\"}\n    -   [BBM]{style=\"color: GhostWhite;\"}\n8.  [Species distribution modeling]{style=\"color: GhostWhite;\"}\n    -   [Resource selection functions]{style=\"color: GhostWhite;\"}\n    -   [Step selection functions]{style=\"color: GhostWhite;\"}\n9.  [Modeling approaches]{style=\"color: GhostWhite;\"}\n:::\n:::\n\n## R packages\n\n![Packages and R tools. Image borrowed from AniMove e-learning classes](./Screenshot 2024-05-08 at 21.48.05.png)\n\n## Movement data\n### Lagragian movement data\n\n- Usually we think of and work with movement data where the position of an animal is collected through a device attached to the animal that allows in principle knowing where the animal is at any time: Lagragian data\n\n    - Radio tracking\n    - Satellite tracking\n    - GPS\n    - Geo-Locators\n\n- The methods differ mainly in their precision\n\n## Movement data\n### Eulerian movement data    \n\n- Eulerian methods violate the unbiased sampling assumption in the spatial domain\n\n    - Camera traps\n    - RFID Tags\n    - Microphon arrays\n    - Rings and band\n\n- The data they provide allow often in specific systems quite a reliable reconstruction of paths\n\n## What is movement?\n\n- Movement is defined as **locations through time**. We can think of movement as a spatio-temporal object. Therefore, a proper definition of space and time is fundamental to analyse data in the proper way\n\n![Brief example of how \"movement\" could be formalized](./Screenshot 2024-05-08 at 21.52.55.png)\n\n## Space problem\n\n- We have already talked about the space problem...\n\n:::: columns\n::: {.column width=\"50%\"}\n![Image from [ESRI website](https://www.esri.com/arcgis-blog/products/arcgis-pro/mapping/gcs_vs_pcs/)](./Screenshot 2024-05-08 at 21.56.05.png)\n:::\n::: {.column width=\"50%\"}\n![Image from [ESRI website](https://www.esri.com/arcgis-blog/products/arcgis-pro/mapping/gcs_vs_pcs/)](./Screenshot 2024-05-08 at 21.56.29.png)\n:::\n::::\n\n- We will soon see how to work with CRS in R, how to set them and how to change them\n\n## Time problem\n\n- Time settings are crucial\n- You need to know what your device uses as time\n- Many handheld GPS use and report local time, others use UTC\n- Time in R is relatively easy to work with\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSys.time()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-05-15 15:49:54 CEST\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(t <- as.POSIXct(\"2022-09-12 14:00:00\", \"%Y-%m-%d %H:%M:%S\", tz=\"CET\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-09-12 14:00:00 CEST\"\n```\n\n\n:::\n:::\n\n\n\n## Databases\n\n### [movebank.org](https://www.movebank.org/cms/movebank-main)\n\n:::: columns\n::: {.column width=\"50%\"}\n- As of February 2024, Movebank stores 6.1 billion animal locations\n- Billions bio-logged sensor measurements managed by thousands of researchers and wildlife managers \n- Data represent the movements and behavior of over 200,000 animals and 1,383 species \n- Approximately over 11 million new data records per day\n:::\n\n::: {.column width=\"50%\"}\n![The movebank.org homepage](./Screenshot 2024-05-08 at 14.05.41.png)\n:::\n::::\n\n## Lets work with some data...\n\n- These are the libraries that we will use. In particular, *move2* [@Kranstauber2023] is a library that allows to access MoveBank data directly and import them in R\n- If you do not have them already, install them using the following lines of code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"move2\")\ninstall.packages(\"readr\")\n```\n:::\n\n\n\n- We can now load all the libraries that are going to be needed to run the excercise\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(move2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 methods overwritten by 'readr':\n  method                    from \n  as.data.frame.spec_tbl_df vroom\n  as_tibble.spec_tbl_df     vroom\n  format.col_spec           vroom\n  print.col_spec            vroom\n  print.collector           vroom\n  print.date_names          vroom\n  print.locale              vroom\n  str.col_spec              vroom\n```\n\n\n:::\n:::\n\n\n\n## Get data from Movebank\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### 1. Directly downloading data from Movebank ####\n\n# For the actual download we will look at three functions:\n# movebank_download_study_info() movebank_download_deployment() movebank_download_study()\n\n### store the movebank credentials for the most used account.\n# you will be promped to set a keyring password\n# by default this will be stored in the key list as service=\"movebank\"\nmovebank_store_credentials(\"RBook\", \"Obstberg1\")\n\n### Browse the Movebank database\n# get the metadata of the studies visible from this account\n(allStudies <- movebank_download_study_info())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `vroom()` finds reading problems with the movebank specification.\nℹ This might relate to the returned data not fitting the expectation of the\n  movebank data format specified in the package.\nℹ For retrieving the specific problem you can enable `global_entrace` using\n  `rlang::global_entrace()` then run the command and use\n  `rlang::last_warnings()[[1]]$problems` to retrieve the problems.\nℹ The requested url can then be retrieved with:\n  `rlang::last_warnings()[[1]]$url`\nℹ Alternatively in some cases you might be able to retrieve the problems\n  calling `vroom::problems()` on the result of the function call that produced\n  the warning.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6,825 × 31\n   acknowledgements           citation go_public_date grants_used      has_quota\n   <chr>                      <chr>    <dttm>         <chr>            <lgl>    \n 1  <NA>                      <NA>     NA              <NA>            TRUE     \n 2  <NA>                      <NA>     NA              <NA>            TRUE     \n 3 \"Supported by the Max-Pla… <NA>     NA              <NA>            TRUE     \n 4  <NA>                      <NA>     NA              <NA>            TRUE     \n 5 \"Graduate students in the… MCKINNO… NA             \"Natural Scienc… TRUE     \n 6  <NA>                      <NA>     NA              <NA>            TRUE     \n 7 \"Universidad Estatal de S… <NA>     NA             \"Comisión Feder… TRUE     \n 8  <NA>                      <NA>     NA              <NA>            TRUE     \n 9  <NA>                      <NA>     NA              <NA>            TRUE     \n10  <NA>                      <NA>     NA              <NA>            TRUE     \n# ℹ 6,815 more rows\n# ℹ 26 more variables: i_am_owner <lgl>, id <int64>, is_test <lgl>,\n#   license_terms <chr>, license_type <fct>, name <fct>,\n#   number_of_individuals [count], number_of_tags [count],\n#   principal_investigator_address <chr>, principal_investigator_email <chr>,\n#   principal_investigator_name <chr>, study_objective <chr>, study_type <fct>,\n#   suspend_license_terms <lgl>, i_can_see_data <lgl>, …\n```\n\n\n:::\n:::\n\n\n\n## Get data from Movebank\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# list studies for which we have download access\nmovebank_download_study_info(i_have_download_access=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 821 × 31\n   acknowledgements           citation go_public_date grants_used      has_quota\n   <chr>                      <chr>    <dttm>         <chr>            <lgl>    \n 1 \"Graduate students in the… \"MCKINN… NA             \"Natural Scienc… TRUE     \n 2 \"This research was conduc…  <NA>    NA             \"the Sea to Sou… TRUE     \n 3  <NA>                      \"Therri… NA              <NA>            TRUE     \n 4  <NA>                      \"Knieri… NA             \"Suwanwaree, P.… TRUE     \n 5 \"<b>1990s field study</b>… \"</br>P… NA             \"<b>1990s field… TRUE     \n 6 \"Nicola Palmer\"             <NA>    NA              <NA>            TRUE     \n 7 \"MPIAB\"                     <NA>    NA             \"MPIAB\"          TRUE     \n 8  <NA>                      \"Carras… NA              <NA>            TRUE     \n 9  <NA>                       <NA>    NA              <NA>            TRUE     \n10 \"These data were collecte… \"Dokter… NA             \"ZKO grant NWO,… TRUE     \n# ℹ 811 more rows\n# ℹ 26 more variables: i_am_owner <lgl>, id <int64>, is_test <lgl>,\n#   license_terms <chr>, license_type <fct>, name <fct>,\n#   number_of_individuals [count], number_of_tags [count],\n#   principal_investigator_address <chr>, principal_investigator_email <chr>,\n#   principal_investigator_name <chr>, study_objective <chr>, study_type <fct>,\n#   suspend_license_terms <lgl>, i_can_see_data <lgl>, …\n```\n\n\n:::\n:::\n\n\n\n## Get data from Movebank\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select only columns of interest and studies about bats\nmovebank_download_study_info() %>% \n  select(id, name, number_of_deployed_locations) %>% \n  filter(grepl(\"Parti-colored bat\", name))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `vroom()` finds reading problems with the movebank specification.\nℹ This might relate to the returned data not fitting the expectation of the\n  movebank data format specified in the package.\nℹ For retrieving the specific problem you can enable `global_entrace` using\n  `rlang::global_entrace()` then run the command and use\n  `rlang::last_warnings()[[1]]$problems` to retrieve the problems.\nℹ The requested url can then be retrieved with:\n  `rlang::last_warnings()[[1]]$url`\nℹ Alternatively in some cases you might be able to retrieve the problems\n  calling `vroom::problems()` on the result of the function call that produced\n  the warning.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n       id name                               number_of_deployed_locations\n  <int64> <fct>                                                   [count]\n1 1918503 Parti-colored bat Safi Switzerland                         1740\n```\n\n\n:::\n:::\n\n\n\n. . .\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# retrieve all sensor ids recognized by Movebank\nmovebank_retrieve(\n  entity_type = \"tag_type\",\n  attributes = c(\"external_id\", \"id\")\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 21 × 2\n   external_id                  id\n   <chr>                   <int64>\n 1 bird-ring                   397\n 2 gps                         653\n 3 radio-transmitter           673\n 4 argos-doppler-shift       82798\n 5 natural-mark            2365682\n 6 acceleration            2365683\n 7 solar-geolocator        3886361\n 8 accessory-measurements  7842954\n 9 solar-geolocator-raw    9301403\n10 barometer              77740391\n# ℹ 11 more rows\n```\n\n\n:::\n:::\n\n\n\n## Get data from Movebank\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Download information about a specific Movebank study\n### get the id of the study (also part of the name but with unique match)\nmovebank_get_study_id(\"Parti-colored bat\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ninteger64\n[1] 1918503\n```\n\n\n:::\n\n```{.r .cell-code}\n# get the metadata of the study\nmovebank_download_study_info(study_id = 1918503) %>% \n  print(width = Inf) #all cols\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 31\n  acknowledgements                                                              \n  <chr>                                                                         \n1 \"The study wouldn’t have been possible with the help of many people in the fi…\n  citation                                                                      \n  <chr>                                                                         \n1 K. Safi, B. König & G. Kerth (2007) Implications of sex-specific habitat use …\n  go_public_date grants_used has_quota i_am_owner      id is_test\n  <dttm>         <chr>       <lgl>     <lgl>      <int64> <lgl>  \n1 NA             <NA>        TRUE      FALSE      1918503 FALSE  \n  license_terms                                                                 \n  <chr>                                                                         \n1 The data can be used for educational and scientific purposes without any rest…\n  license_type name                               number_of_individuals\n  <fct>        <fct>                                            [count]\n1 CUSTOM       Parti-colored bat Safi Switzerland                    17\n  number_of_tags principal_investigator_address principal_investigator_email\n         [count] <chr>                          <chr>                       \n1             25 <NA>                           <NA>                        \n  principal_investigator_name\n  <chr>                      \n1 Kami (Kamran Safi)         \n  study_objective                                                               \n  <chr>                                                                         \n1 \"M. L. van Toor, C. Jaberg & K. Safi (2011) Habitat suitability models and th…\n  study_type suspend_license_terms i_can_see_data\n  <fct>      <lgl>                 <lgl>         \n1 research   FALSE                 TRUE          \n  there_are_data_which_i_cannot_see i_have_download_access i_am_collaborator\n  <lgl>                             <lgl>                  <lgl>            \n1 FALSE                             TRUE                   FALSE            \n  study_permission timestamp_first_deployed_location\n  <fct>            <dttm>                           \n1 na               2002-06-02 22:55:11              \n  timestamp_last_deployed_location number_of_deployed_locations\n  <dttm>                                                [count]\n1 2003-06-23 03:25:00                                      1740\n  taxon_ids           sensor_type_ids   contact_person_name       main_location\n  <chr>               <chr>             <fct>                       <POINT [°]>\n1 Vespertilio murinus Radio Transmitter Kami (Kamran Safi)  (9.002781 47.76668)\n```\n\n\n:::\n:::\n\n\n\n## Get data from Movebank\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Download LOCATION data as a move2 object ----\n### download all data (all sensors, all animals)\nmovebank_download_study(study_id = 1918503) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ In total 249 records were omitted as they were not deployed (the\n  `deployment_id` was `NA`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nA <move2> with `track_id_column` \"individual_local_identifier\" and\n`time_column` \"timestamp\"\nContaining 17 tracks lasting on average 7.22 days in a\nSimple feature collection with 1740 features and 7 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 7.026008 ymin: 46.89989 xmax: 8.693484 ymax: 47.65558\nGeodetic CRS:  WGS 84\n# A tibble: 1,740 × 8\n   sensor_type_id individual_local_identifier tag_local_identifier\n          <int64> <fct>                       <fct>               \n 1            673 191                         <NA>                \n 2            673 191                         <NA>                \n 3            673 191                         <NA>                \n 4            673 191                         <NA>                \n 5            673 191                         <NA>                \n 6            673 191                         <NA>                \n 7            673 191                         <NA>                \n 8            673 191                         <NA>                \n 9            673 191                         <NA>                \n10            673 191                         <NA>                \n# ℹ 1,730 more rows\n# ℹ 5 more variables: manually_marked_outlier <lgl>, timestamp <dttm>,\n#   visible <lgl>, event_id <int64>, geometry <POINT [°]>\nFirst 10 track features:\n# A tibble: 17 × 40\n   deployment_id  tag_id individual_id sensor_type_ids capture_location\n         <int64> <int64>       <int64> <chr>                <POINT [°]>\n 1       1918729 1918728       1918727 radio-transmit…            EMPTY\n 2       1918750 1918749       1918748 radio-transmit…            EMPTY\n 3       1918741 1918740       1918739 radio-transmit…            EMPTY\n 4       1918738 1918737       1918736 radio-transmit…            EMPTY\n 5       1918735 1918734       1918733 radio-transmit…            EMPTY\n 6       1918726 1918725       1918724 radio-transmit…            EMPTY\n 7       1918747 1918746       1918745 radio-transmit…            EMPTY\n 8       1918732 1918731       1918730 radio-transmit…            EMPTY\n 9       1918744 1918743       1918742 radio-transmit…            EMPTY\n10       1918934 1918933       1918932 radio-transmit…            EMPTY\n# ℹ 7 more rows\n# ℹ 35 more variables: deploy_on_location <POINT [°]>,\n#   deploy_off_location <POINT [°]>, individual_local_identifier <fct>,\n#   sex <fct>, taxon_canonical_name <fct>,\n#   individual_number_of_deployments <int>, mortality_location <POINT [°]>,\n#   tag_number_of_deployments <int>, study_id <int64>, acknowledgements <chr>,\n#   citation <chr>, has_quota <lgl>, i_am_owner <lgl>, is_test <lgl>, …\n```\n\n\n:::\n:::\n\n\n\n## Get data from a CSV file downloaded from Movebank\n\n- We will now assume we downloaded a dataset from Movebank and we will import it in to R\n- Use [this](https://drive.proton.me/urls/JKGD8SYASR#qYRvkKaVjr10) link to download a .csv file with with the dataset we will be using\n- Place the dataset in a directory where you will be working\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### We read in this dataset downloaded from Movebank directly as a move2 object\nbats <- mt_read(\"/PATH TO YOUR DIRECTORY/Parti-colored bat Safi Switzerland.csv\")\nstr(bats)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nmove2 [1,740 × 7] (S3: move2/sf/tbl_df/tbl/data.frame)\n $ event-id                   :integer64 [1:1740] 16309975 16309976 16309877 16309874 16309878 16309886 16309887 16309888 ... \n $ visible                    : logi [1:1740] TRUE TRUE TRUE TRUE TRUE TRUE ...\n $ timestamp                  : POSIXct[1:1740], format: \"2002-06-02 22:55:11\" \"2002-06-02 23:04:30\" ...\n $ manually-marked-outlier    : logi [1:1740] NA NA NA NA NA NA ...\n $ sensor-type                : Factor w/ 21 levels \"bird-ring\",\"gps\",..: 3 3 3 3 3 3 3 3 3 3 ...\n $ individual-local-identifier: Factor w/ 17 levels \"021\",\"553\",\"321\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ geometry                   :sfc_POINT of length 1740; first list element:  'XY' num [1:2] 8.6 47.6\n - attr(*, \"sf_column\")= chr \"geometry\"\n - attr(*, \"agr\")= Factor w/ 3 levels \"constant\",\"aggregate\",..: NA NA NA NA NA NA\n  ..- attr(*, \"names\")= chr [1:6] \"event-id\" \"visible\" \"timestamp\" \"manually-marked-outlier\" ...\n - attr(*, \"time_column\")= chr \"timestamp\"\n - attr(*, \"track_id_column\")= chr \"individual-local-identifier\"\n - attr(*, \"track_data\")='data.frame':\t17 obs. of  4 variables:\n  ..$ individual-taxon-canonical-name: Factor w/ 1 level \"Vespertilio murinus\": 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ study-name                     : Factor w/ 1 level \"Parti-colored bat Safi Switzerland\": 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ tag-local-identifier           : Factor w/ 17 levels \"#1918746\",\"#1918743\",..: 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ individual-local-identifier    : Factor w/ 17 levels \"021\",\"553\",\"321\",..: 1 2 3 4 5 6 7 8 9 10 ...\n```\n\n\n:::\n:::\n\n\n\n## References",
    "supporting": [
      "class_2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}